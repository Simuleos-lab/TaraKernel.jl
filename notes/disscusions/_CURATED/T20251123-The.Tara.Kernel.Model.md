## What exists in the Tape kernel

- The flow can be represented like this, for instance:
    - `GeneralFlow`
    - `StoreBackend.Tape` - I -> `TaraKernel` - II -> `RunTime.Record`
    - `RunTime.Record` - III -> `TaraKernel` - IV ->  `StoreBackend.Tape`
- Whatever is fundamental for doing this function must be in the kernel
- Whatever is not, must be out.

### **Tape**

- A tape is a *finite, ordered sequence* of segments stored somewhere, somehow.
    - For instance, in a file system
    

---

## 2. What is *not* part of the Tape kernel

- **Artifacts**
- Heavy data is always handled outside the kernel.
- The intend is that a link object (regular TaraSON) is stored as regular record data.
    - For the Kernel a link is just regular data

- **Concurrency or transactional models**
- Multi-process safety belongs to the environment and file-system semantics.
- Kernel assumes append-only correctness without higher-level locking strategies.
- aka: The user is reponsable for any race condition

- **High-level querying**
- Kernel supports simple iteration over StaticRecords.
- That's it!
- Advanced queries should occur in higher-level systems.

---

## 3. Kernel operations

- **Canonicalization**
- `DynamicLiteRecord` -> canonical flat TaraSON object.
- Deterministic key order and normalization.
- Non-lite fields cause error on:
    - Any kernel boundary
        - input: creation/read.
        - output: write.

- **Hashing**
- Hash is derived from TaraSON bytes.
    - either canonical or not
    - we will have many hashed
- Deterministic
    - Same representatiom -> same hash.

- **Appending**
- Append creates a new segment or extends the active one.
- Append is the only way to add records.

- **Reading**
- Reading always yields StaticRecords.
- Records are returned exactly as they appear canonically.

## 5. Kernel invariants

1. **Immutability**

   * Segments and StaticRecords are immutable.
   * Tape structure can only change via append or repack.

2. **Determinism**

   * Canonicalization must produce stable output.
   * Hash must always match canonical bytes.

3. **No semantic interpretation**

   * Kernel does not understand “Issue”, “Scope”, “Context”.
   * It only sees TaraSON payloads.

4. **Consistency**

   * Tapes must be readable after crashes.
   * Meta can be reconstructed if missing, producing a new tape.

5. **Equivalence**

   * Two tapes are equivalent if they expand to the same ordered list of canonical records.

---

## OUTDATED IDEAS

- `#IGNORE`

- **Store as an active semantic layer**  
  Removed assumptions implying the Store had semantic responsibilities; now it is only a directory helper.

- **Segment metadata as arbitrarily rich structures**  
  Trimmed language suggesting flexible metadata; kernel only preserves structural meta.

- **Implicit support for nested or complex record structures**  
  Removed hints contradicting the strict flat TaraSON model.

- **Any reference to kernel interpreting Scopes or Issues**  
  These belong entirely to the Recorder layer under the updated architecture.

- **Suggestions that DynamicLiteRecord could have additional modes or history**  
  Only a single transformation path is allowed in the current model.
