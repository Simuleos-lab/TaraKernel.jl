
---
## Tara Kernel: Scope

#MODEL
The Tape kernel is the minimal component responsible for "legally" moving records between:

- `StoreBackend.Tape` → `TaraKernel` → `RunTime.Record`
- `RunTime.Record` → `TaraKernel` → `StoreBackend.Tape`

Whatever is **fundamental for doing this function** belongs in the kernel.  
Whatever is not fundamental **must be outside** the kernel.

---
## Tara Kernel: Purpose

#MODEL 
The kernel:
- operates over **Tapes** and their segments,
- consumes and produces **runtime records**,
- enforces canonicalization, hashing, committing, and validation,
- guarantees a small set of invariants.

Higher-level meaning (Issues, Scopes, Contexts, etc.) is explicitly **out of scope**.

---
## Tara Kernel: In-Kernel Objects (Tape)

#MODEL
A **Tape** is a **finite, ordered sequence of segments** stored somewhere, somehow.

- The storage substrate is abstract.
- A Tape’s identity and semantics are defined purely by:
  - the ordered sequence of its segments,
  - the canonical records obtained from those segments.

---
## Tara Kernel: Out-of-Scope

#MODEL
The following concerns are explicitly **not** part of the Tape kernel.
### Artifacts and Heavy Data

- Heavy data is always handled **outside** the kernel.
- Artifact references are stored as regular TaraSON fields.
- For the kernel, a link is just data and carries no special semantics.

### Concurrency and Transaction Models

- Multi-process safety and locking belong to storage backends and the environment.
- The kernel assumes append-only correctness.
- Race conditions are the responsibility of the user and runtime environment.

### High-Level Querying

- The kernel query capability most remaind limited, like **simple iteration**.
- Advanced querying occurs outside the kernel.

---
## Tara Kernel: Canonicalization

#MODEL
Converts runtime records into canonical TaraSON.

- Input:
  - runtime records (DynamicLiteRecord or equivalent)
- Output:
  - canonical flat TaraSON object

Rules:
- Key order and representation must be deterministic.
- Non-lite values are rejected at all kernel boundaries:
  - input (creation / read),
  - output (write).

---
## Tara Kernel: Hashing

#MODEL
Assigns deterministic identities to TaraSON bytes.

Rules:
- Hashes are derived from TaraSON bytes.
- The same bytes must always yield the same hash.
- Many hashed representations may exist in different pipeline stages.
- The kernel only requires that each hashing use is deterministic.

---
## Tara Kernel: Appending

#MODEL
Appending is one of the two ways to change a Tape, along with repacking.

Rules:
- Appending:
  - creates a new segment or
  - extends the active one.
- Existing segments and records are never modified.
- Reordering or deletion is forbidden.

---
## Tara Kernel: Repacking

#MODEL
Repacking is one of the two ways to change a Tape, along with appending.

Rules:
- Repacking:
  - changes the borders defining segments
  - does not reorder records
  - only modifies the hierarchical organization of segments
  - only rehashes from the modified layer and above

---
## Tara Kernel: Reading

#MODEL
Reading yields records exactly as stored.

Rules:
- All reads return **StaticRecords**.
- Returned records are byte-identical to canonical storage.
- No interpretation, inference, or semantic decoding is performed.

---
## Tara Kernel: Content Integrity System

#MODEL 
- The kernel is responsible for enforcing content integrity at all structural levels.
- This responsibility is handled by the **Content Integrity System**.
- The kernel is the authority on whether content is:
	- correctly hashed,
	- structurally committed,
	- and internally consistent.

---
## Tara Kernel: Record Hash Enforcement

#MODEL
For every record:
- A content hash is mandatory.
- The stored hash must match the hash recomputed from canonical bytes.

A record is invalid if:
- the hash is missing,
- or the recomputed hash differs from the stored value.

---
## Tara Kernel: Input/output:

#MODEL #GUARANTEE
- Invalid records are rejected at input.
- Invalid records are never appended.
- Invalid records are never returned.

---
## Tara Kernel: Segment commit validation:

#MODEL #GUARANTEE
- Commit records are validated before use.
- Invalid segments are rejected.
- Corruption is never silently accepted.

---
## Tara Kernel: Tape-level hashing:

#MODEL #GUARANTEE
- Appending changes tape identity.
- Repacking does not change identity.
- Any invalid segment invalidates the tape.

---
## Tara Kernel: Content invariants

#MODEL #GUARANTEE
- unlocked content never reaches storage,
- invalid hashes are never returned,
- corrupted structures are never treated as valid.

---
## Tara Kernel: Segment Commit Validation

#MODEL
Each segment MUST expose at least one **commit record**.

A commit record:
- binds segment content to a content hash,
- depends on its full segment scope,
- defines the integrity identity of the segment scope.

The kernel do define:
- how commits are encoded,
- where they are stored,

But do not define:
- what hash algorithm is used.

---
## Tara Kernel: Tape-Level Hashing

#MODEL 
A Tape has a content identity derived from:
- its ordered segments,
- each verified for integrity.

Kernel guarantees:
- Appending changes tape identity.
- Repacking does not change identity.
- Any invalid segment invalidates the tape.

Identity depends only on content, not physical layout.

---
## Tara Kernel: Hash-Locked Content Invariant

#MODEL 
All kernel-managed content is **hash-locked**:
- Records are locked by content hashes.
- Segments are locked by commit hashes.
- Tapes are locked by structural hashes.

The kernel guarantees:
- unlocked content never reaches storage,
- invalid hashes are never returned,
- corrupted structures are never treated as valid.

The kernel does not mandate *how* hashes are computed —  
only that they exist, are verified, and are enforced.

---
## Tara Kernel: Immutability

#MODEL #INVARIANT
- Segments and StaticRecords are immutable.
- Tape structure changes only via append or repack.

---
## Tara Kernel: Determinism

#MODEL #INVARIANT
- Canonicalization is stable.
- Hashing is deterministic.
- Identical input yields identical identity.

---
## Tara Kernel: No Semantic Interpretation

#MODEL #INVARIANT
- The kernel does not understand domain concepts.
- It manipulates TaraSON only as data.

---
## Tara Kernel: Consistency

#MODEL #INVARIANT
- Tapes remain readable after crashes.
- Metadata can be reconstructed from segments.
- Reconstruction must preserve record order.

---
## Tara Kernel: Tape Equivalence

#MODEL #INVARIANT
Two tapes are equivalent iff:
- they expand to the same ordered list of canonical records.
Layout, segmentation, or storage backend do not affect equivalence.
